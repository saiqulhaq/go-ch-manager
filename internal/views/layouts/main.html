<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.PageTitle}} - Go CH Manager</title>

    <!-- Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        gray: {
                            750: '#2d3748',
                            850: '#1a202c',
                            900: '#111827',
                            950: '#030712', // Ultra dark for background
                        },
                        primary: {
                            400: '#FFE066',
                            500: '#FFCC00',
                            600: '#E6B800',
                            700: '#CCA300',
                            glow: 'rgba(255, 204, 0, 0.5)' // Custom glow color (Yellow)
                        }
                    },
                    boxShadow: {
                        'glow': '0 0 15px rgba(255, 204, 0, 0.3)',
                        'glow-lg': '0 0 25px rgba(255, 204, 0, 0.4)',
                    }
                }
            }
        }
    </script>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- NProgress -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>

    <style>
        /* Custom NProgress */
        #nprogress .bar {
            background: #FFCC00 !important;
            /* Primary 500 */
            height: 7px !important;
            box-shadow: 0 0 10px #FFCC00, 0 0 5px #FFCC00;
        }

        /* Modern Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
            border: 2px solid #0f172a;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }

        /* Glassmorphism Utilities */
        .glass {
            background: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .glass-sidebar {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(12px);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }

        body {
            background-color: #030712;
            /* Gray 950 */
            background-image: radial-gradient(circle at 15% 50%, rgba(255, 204, 0, 0.08) 0%, transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(255, 204, 0, 0.08) 0%, transparent 25%);
        }
    </style>
</head>

<body
    class="text-gray-200 font-sans antialiased h-screen flex overflow-hidden selection:bg-primary-500 selection:text-white">

    <!-- Sidebar -->
    <aside
        class="w-64 glass-sidebar flex flex-col transition-all duration-300 z-20 shadow-2xl relative overflow-hidden">
        <!-- Decorative Gradient Blob -->
        <div
            class="absolute bottom-0 left-0 w-64 h-64 bg-primary-500/30 rounded-full blur-[80px] pointer-events-none -translate-x-1/3 translate-y-1/3 z-0">
        </div>

        <!-- Logo Area -->
        <div class="h-20 flex items-center px-6 border-b border-white/5">
            <a href="/" class="group flex items-center gap-3 decoration-0">
                <div
                    class="relative w-9 h-9 flex items-center justify-center bg-primary-600 rounded-xl shadow-lg ring-1 ring-white/10 group-hover:scale-105 transition-transform duration-300">
                    <div class="absolute inset-0 bg-gradient-to-tr from-white/20 to-transparent rounded-xl"></div>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                    </svg>
                </div>
                <div class="flex flex-col">
                    <span
                        class="text-lg font-bold text-white tracking-tight leading-none group-hover:text-primary-400 transition-colors">CH
                        Manager</span>
                    <span class="text-[10px] uppercase font-semibold text-gray-500 tracking-wider">Optimus</span>
                </div>
            </a>
        </div>

        <!-- Navigation -->
        <div class="flex-1 overflow-y-auto py-6 px-3 space-y-6">
            <!-- Connection Selector & Menu -->
            <div>
                {{$activeID := .ConnectionID}}
                {{if .Connection}}
                {{$activeID = .Connection.ID}}
                {{end}}

                <div class="px-3 mb-2 text-[11px] font-bold text-gray-500 uppercase tracking-widest">Active Connection
                </div>

                <div class="px-3 mb-6">
                    <div class="relative group">
                        <select
                            onchange="if(this.value) window.location.href='/connections/'+this.value; else window.location.href='/';"
                            class="w-full appearance-none bg-black/20 border border-white/10 text-gray-300 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 cursor-pointer hover:bg-white/5 transition-colors">
                            <option value="">Select Connection...</option>
                            {{range .SidebarConnections}}
                            <option value="{{.ID}}" {{if eq .ID $activeID}}selected{{end}}>{{.Name}}</option>
                            {{end}}
                        </select>
                        <div
                            class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                            </svg>
                        </div>
                    </div>

                    <a href="/"
                        class="mt-2 text-xs flex items-center text-gray-500 hover:text-primary-400 transition-colors ml-1">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                        </svg>
                        Manage Connections
                    </a>
                </div>

                {{if $activeID}}
                <div class="px-3 mb-2 text-[11px] font-bold text-gray-500 uppercase tracking-widest">Features</div>
                <nav class="space-y-1">

                    <!-- Overview -->
                    <a href="/connections/{{$activeID}}" class="group flex items-center px-3 py-2.5 text-sm font-medium rounded-lg transition-all duration-200
{{if eq .ActiveMenu " overview"}}bg-white/5 text-primary-400{{else}}text-gray-400 hover:bg-white/5
                        hover:text-white{{end}}">

                        <svg class="mr-3 h-5 w-5 transition-colors
{{if eq .ActiveMenu " overview"}}text-primary-400{{else}}text-gray-500 group-hover:text-primary-400{{end}}" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>

                        Overview
                    </a>

                    <!-- Explorer -->
                    <a href="/connections/{{$activeID}}/tables" class="group flex items-center px-3 py-2.5 text-sm font-medium rounded-lg transition-all duration-200
{{if eq .ActiveMenu " explorer"}}bg-white/5 text-primary-400{{else}}text-gray-400 hover:bg-white/5
                        hover:text-white{{end}}">

                        <svg class="mr-3 h-5 w-5 transition-colors
{{if eq .ActiveMenu " explorer"}}text-primary-400{{else}}text-gray-500 group-hover:text-primary-400{{end}}" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                        </svg>

                        Schema Explorer
                    </a>

                    <!-- Console -->
                    <a href="/connections/{{$activeID}}/console" class="group flex items-center px-3 py-2.5 text-sm font-medium rounded-lg transition-all duration-200
{{if eq .ActiveMenu " console"}}bg-white/5 text-primary-400{{else}}text-gray-400 hover:bg-white/5
                        hover:text-white{{end}}">

                        <svg class="mr-3 h-5 w-5 transition-colors
{{if eq .ActiveMenu " console"}}text-primary-400{{else}}text-gray-500 group-hover:text-primary-400{{end}}" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>

                        Console
                    </a>

                    <!-- Compare -->
                    <a href="/connections/{{$activeID}}/compare" class="group flex items-center px-3 py-2.5 text-sm font-medium rounded-lg transition-all duration-200
{{if eq .ActiveMenu " compare"}}bg-white/5 text-primary-400{{else}}text-gray-400 hover:bg-white/5
                        hover:text-white{{end}}">

                        <svg class="mr-3 h-5 w-5 transition-colors
{{if eq .ActiveMenu " compare"}}text-primary-400{{else}}text-gray-500 group-hover:text-primary-400{{end}}" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>

                        Compare
                    </a>

                </nav>
                {{else}}
                <div class="px-6 py-4 text-center">
                    <p class="text-sm text-gray-500">Select a connection to view features</p>
                </div>
                {{end}}
            </div>

        </div>

        <!-- Footer -->
        <div class="p-4 border-t border-white/5 bg-black/20">
            <div class="flex items-center justify-between">
                <div class="text-[10px] text-gray-500 font-mono">v0.1.0-beta</div>
                <div class="flex space-x-2">
                    <div class="w-2 h-2 rounded-full bg-gray-700 hover:bg-green-500 transition-colors cursor-help"
                        title="System Status: Online"></div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content Wrapper -->
    <main class="flex-1 overflow-hidden relative flex flex-col">
        <!-- Top Bar (Optional, can be used for breadcrumbs or active user profile) -->
        <!-- <header class="h-16 flex items-center justify-between px-8 border-b border-white/5 glass z-10">
           ...
        </header> -->

        <!-- Content Area -->
        <div class="flex-1 overflow-y-auto w-full scroll-smooth">
            <div class="max-w-7xl mx-auto p-8 lg:p-10">
                {{embed}}
            </div>
        </div>
    </main>

    <script>
        // NProgress Integration
        NProgress.configure({ showSpinner: false, speed: 500 });

        // Trigger on click of any internal link
        document.addEventListener('click', function (e) {
            const anchor = e.target.closest('a');
            if (anchor && anchor.href && anchor.href.startsWith(window.location.origin) && !anchor.hasAttribute('download') && anchor.target !== '_blank') {
                NProgress.start();
            }
        });

        // Trigger on form submit
        document.addEventListener('submit', function () {
            NProgress.start();
        });

        // Stop on page load (in case it was running from cached state)
        window.addEventListener('load', function () {
            NProgress.done();
        });

        // Also stop when pages show from bfcache
        window.addEventListener('pageshow', function () {
            NProgress.done();
        });
    </script>
</body>

</html>